import { Injectable } from '@angular/core';
import { map } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "./crud.service";
export class CoursesService {
    constructor(crudSerive) {
        this.crudSerive = crudSerive;
        this._coursesCollection = 'courses';
        this._chaptersCollection = 'chapters';
        this._projectsCollection = 'project';
        this._lecturesCollection = 'lectures';
        this._slidesCollection = 'slides';
    }
    //Courses Methods:
    //=============================================================
    getAllCourses() {
        return this.crudSerive
            .getDataByOrder(this._coursesCollection, 'seqNo')
            .pipe(map((docSnapShots) => {
            return docSnapShots.map((docSnap) => {
                return {
                    id: docSnap.payload.doc.id,
                    ...docSnap.payload.doc.data(),
                };
            });
        }));
    }
    getCourse(courseID) {
        return this.crudSerive.getSignleDoc(this._coursesCollection, courseID).pipe(map((courseDocSnap) => {
            return {
                id: courseDocSnap.id,
                ...courseDocSnap.data(),
            };
        }));
    }
    async createNewCourse(courseTitle, courseDescription, seqNo) {
        return new Promise((resolve, reject) => {
            this.crudSerive
                .addData(this._coursesCollection, {
                title: courseTitle,
                description: courseDescription,
                seqNo,
            })
                .then((res) => resolve(res))
                .catch((error) => reject(error));
        });
    }
    async editCourse(courseID, data) {
        return new Promise((resolve, reject) => {
            this.crudSerive
                .updateData(this._coursesCollection, courseID, data)
                .then((res) => resolve(res))
                .catch((error) => reject(error));
        });
    }
    async deleteCourse(courseID) {
        return new Promise((resolve, reject) => {
            this.crudSerive
                .deleteData(this._coursesCollection, courseID)
                .then((res) => resolve(res))
                .catch((error) => reject(error));
        });
    }
    //=============================================================
    //Chapters Methods:
    //=============================================================
    //Get all chapters
    getChapters(courseID) {
        return this.crudSerive
            .getDataByOrder(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}`, 'seqNo')
            .pipe(map((docSnaps) => {
            return docSnaps.map((snap) => {
                return {
                    id: snap.payload.doc.id,
                    ...snap.payload.doc.data(),
                };
            });
        }));
    }
    //Get chapter ID by seqNo: 1
    getFirstChapter(courseID) {
        return this.crudSerive
            .getSingleDataByField(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}`, 'seqNo', 1)
            .pipe(map((chapterDocSnap) => {
            return chapterDocSnap[0].payload.doc.id;
        }));
    }
    async createNewCourseChapter(courseID, data) {
        return new Promise((resolve, reject) => {
            this.crudSerive
                .addDataToSubCollection(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}`, data)
                .then((res) => resolve(res))
                .catch((error) => reject(error));
        });
    }
    async editChapterDetails(courseID, chapterID, data) {
        return new Promise((resolve, reject) => {
            this.crudSerive
                .updateData(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}`, chapterID, data)
                .then((res) => resolve(res))
                .catch((error) => reject(error));
        });
    }
    async deleteChapter(courseID, chapterID) {
        return new Promise((resolve, reject) => {
            this.crudSerive
                .deleteData(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}`, chapterID)
                .then((res) => resolve(res))
                .catch((error) => reject(error));
        });
    }
    //=============================================================
    //Projects Methods:
    //=============================================================
    // add Project
    addProjects(id, data) {
        this.crudSerive.addData(`${this._coursesCollection}/${id}/${this._projectsCollection}`, data);
    }
    // Get Data From Collection Project
    getDataProject(id) {
        return this.crudSerive
            .getData(`${this._coursesCollection}/${id}/${this._projectsCollection}`)
            .pipe(map((data) => {
            return data.map((ele) => {
                return {
                    id: ele.payload.doc.id,
                    ...ele.payload.doc.data(),
                };
            });
        }));
    }
    // delet Project
    deletProject(id, uid) {
        return this.crudSerive.deleteData(`${this._coursesCollection}/${id}/${this._projectsCollection}`, uid);
    }
    // getOne For card Project
    getOneProject(id, uid) {
        return this.crudSerive
            .getSignleDoc(`${this._coursesCollection}/${id}/${this._projectsCollection}`, uid)
            .pipe(map((projectDocSnap) => {
            return { ...projectDocSnap.data() };
        }));
    }
    //  Edit Card For Project
    editCard(id, uid, title) {
        return this.crudSerive.updateData(`${this._coursesCollection}/${id}/${this._projectsCollection}`, uid, { title });
    }
    //  Edit Content inside Project
    editContent(courseID, uid, content) {
        return this.crudSerive.updateData(`${this._coursesCollection}/${courseID}/${this._projectsCollection}/`, uid, {
            content,
        });
    }
    //=============================================================
    //=============================================================
    //Lectures Methods:
    //=============================================================
    getAllLectures(courseID, chapterID) {
        return this.crudSerive
            .getDataByOrder(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}/${chapterID}/${this._lecturesCollection}`, 'seqNo')
            .pipe(map((docSnaps) => {
            return docSnaps.map((doc) => {
                return {
                    id: doc.payload.doc.id,
                    ...doc.payload.doc.data(),
                };
            });
        }));
    }
    getFirstLecture(courseID, chapterId) {
        return this.crudSerive
            .getSingleDataByField(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}/${chapterId}/${this._lecturesCollection}`, 'seqNo', 1)
            .pipe(map((docSnaps) => {
            return docSnaps[0].payload.doc.id;
        }));
    }
    async addNewLecture(courseID, chapterID, data) {
        return new Promise((resolve, reject) => {
            this.crudSerive
                .addDataToSubCollection(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}/${chapterID}/${this._lecturesCollection}`, data)
                .then((res) => resolve(res))
                .catch((error) => reject(error));
        });
    }
    async editLectureDetails(courseID, chapterID, lectureID, data) {
        return new Promise((resolve, reject) => {
            this.crudSerive
                .updateData(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}/${chapterID}/${this._lecturesCollection}`, lectureID, data)
                .then((res) => resolve(res))
                .catch((error) => reject(error));
        });
    }
    async deleteLecture(courseID, chapterID, lectureID) {
        return new Promise((resolve, reject) => {
            this.crudSerive
                .deleteData(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}/${chapterID}/${this._lecturesCollection}`, lectureID)
                .then((res) => resolve(res))
                .catch((error) => reject(error));
        });
    }
    //=============================================================
    //=============================================================
    //Slides Methods:
    //=============================================================
    getAllSlides(courseID, chapterID, lectureID) {
        return this.crudSerive
            .getDataByOrder(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}/${chapterID}/${this._lecturesCollection}/${lectureID}/${this._slidesCollection}`, 'seqNo')
            .pipe(map((docSnaps) => {
            return docSnaps.map((docSnap) => {
                return {
                    id: docSnap.payload.doc.id,
                    ...docSnap.payload.doc.data(),
                };
            });
        }));
    }
    async addSlide(courseID, chapterID, lectureID, data) {
        return new Promise((resolve, reject) => {
            this.crudSerive
                .addDataToSubCollection(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}/${chapterID}/${this._lecturesCollection}/${lectureID}/${this._slidesCollection}`, data)
                .then((res) => resolve(res))
                .catch((error) => reject(error));
        });
    }
    async editSlide(courseID, chapterID, lectureID, slideID, data) {
        return new Promise((resolve, reject) => {
            this.crudSerive
                .updateData(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}/${chapterID}/${this._lecturesCollection}/${lectureID}/${this._slidesCollection}`, slideID, data)
                .then((res) => resolve(res))
                .catch((error) => reject(error));
        });
    }
    async deleteSlide(courseID, chapterID, lectureID, slideID) {
        return new Promise((resolve, reject) => {
            this.crudSerive
                .deleteData(`/${this._coursesCollection}/${courseID}/${this._chaptersCollection}/${chapterID}/${this._lecturesCollection}/${lectureID}/${this._slidesCollection}`, slideID)
                .then((res) => resolve(res))
                .catch((error) => reject(error));
        });
    }
    getFirstCourse() {
        return this.crudSerive.getSingleDataAsc(this._coursesCollection);
        // return new Promise((resolve,reject)=>{
        // })
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: CoursesService, deps: [{ token: i1.CrudService }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: CoursesService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: CoursesService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: function () { return [{ type: i1.CrudService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY291cnNlcy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvZGFsL3NyYy9saWIvc2VydmljZXMvY291cnNlcy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFNM0MsT0FBTyxFQUFjLEdBQUcsRUFBb0IsTUFBTSxNQUFNLENBQUM7OztBQU16RCxNQUFNLE9BQU8sY0FBYztJQU16QixZQUFvQixVQUF1QjtRQUF2QixlQUFVLEdBQVYsVUFBVSxDQUFhO1FBTG5DLHVCQUFrQixHQUFHLFNBQVMsQ0FBQztRQUMvQix3QkFBbUIsR0FBRyxVQUFVLENBQUM7UUFDakMsd0JBQW1CLEdBQUcsU0FBUyxDQUFDO1FBQ2hDLHdCQUFtQixHQUFHLFVBQVUsQ0FBQztRQUNqQyxzQkFBaUIsR0FBRyxRQUFRLENBQUM7SUFDUyxDQUFDO0lBRS9DLGtCQUFrQjtJQUNsQiwrREFBK0Q7SUFDL0QsYUFBYTtRQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVU7YUFDbkIsY0FBYyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxPQUFPLENBQUM7YUFDaEQsSUFBSSxDQUNILEdBQUcsQ0FBQyxDQUFDLFlBQVksRUFBRSxFQUFFO1lBQ25CLE9BQU8sWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFO2dCQUNsQyxPQUFlO29CQUNiLEVBQUUsRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO29CQUMxQixHQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksRUFBYTtpQkFDMUMsQ0FBQztZQUNKLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQ0gsQ0FBQztJQUNOLENBQUM7SUFFRCxTQUFTLENBQUMsUUFBZ0I7UUFDeEIsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFlB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TTs7NEZBRVAsY0FBYztrQkFIMUIsVUFBVTttQkFBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDcnVkU2VydmljZSB9IGZyb20gJy4vY3J1ZC5zZXJ2aWNlJztcbmltcG9ydCB7IENvdXJzZSB9IGZyb20gJy4uL21vZGVscy9jb250ZW50L2NvdXJzZSc7XG5pbXBvcnQgeyBDaGFwdGVyIH0gZnJvbSAnLi4vbW9kZWxzL2NvbnRlbnQvY2hhcHRlcic7XG5pbXBvcnQgeyBMZWN0dXJlIH0gZnJvbSAnLi4vbW9kZWxzL2NvbnRlbnQvbGVjdHVyZSc7XG5pbXBvcnQgeyBTcyB9IGZyb20gJy4uL21vZGVscy9jb250ZW50L3NzJztcbmltcG9ydCB7IE9ic2VydmFibGUsIG1hcCwgcGlwZSwgcmV0cnksIHRhcCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgUHJvamVjdCB9IGZyb20gJy4uL21vZGVscy9jb250ZW50L3Byb2plY3QnO1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgQ291cnNlc1NlcnZpY2Uge1xuICBwcml2YXRlIF9jb3Vyc2VzQ29sbGVjdGlvbiA9ICdjb3Vyc2VzJztcbiAgcHJpdmF0ZSBfY2hhcHRlcnNDb2xsZWN0aW9uID0gJ2NoYXB0ZXJzJztcbiAgcHJpdmF0ZSBfcHJvamVjdHNDb2xsZWN0aW9uID0gJ3Byb2plY3QnO1xuICBwcml2YXRlIF9sZWN0dXJlc0NvbGxlY3Rpb24gPSAnbGVjdHVyZXMnO1xuICBwcml2YXRlIF9zbGlkZXNDb2xsZWN0aW9uID0gJ3NsaWRlcyc7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY3J1ZFNlcml2ZTogQ3J1ZFNlcnZpY2UpIHt9XG5cbiAgLy9Db3Vyc2VzIE1ldGhvZHM6XG4gIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICBnZXRBbGxDb3Vyc2VzKCk6IE9ic2VydmFibGU8Q291cnNlW10+IHtcbiAgICByZXR1cm4gdGhpcy5jcnVkU2VyaXZlXG4gICAgICAuZ2V0RGF0YUJ5T3JkZXIodGhpcy5fY291cnNlc0NvbGxlY3Rpb24sICdzZXFObycpXG4gICAgICAucGlwZShcbiAgICAgICAgbWFwKChkb2NTbmFwU2hvdHMpID0+IHtcbiAgICAgICAgICByZXR1cm4gZG9jU25hcFNob3RzLm1hcCgoZG9jU25hcCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIDxDb3Vyc2U+e1xuICAgICAgICAgICAgICBpZDogZG9jU25hcC5wYXlsb2FkLmRvYy5pZCxcbiAgICAgICAgICAgICAgLi4uKGRvY1NuYXAucGF5bG9hZC5kb2MuZGF0YSgpIGFzIG9iamVjdCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxuXG4gIGdldENvdXJzZShjb3Vyc2VJRDogc3RyaW5nKTogT2JzZXJ2YWJsZTxDb3Vyc2U+IHtcbiAgICByZXR1cm4gdGhpcy5jcnVkU2VyaXZlLmdldFNpZ25sZURvYyh0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbiwgY291cnNlSUQpLnBpcGUoXG4gICAgICBtYXAoKGNvdXJzZURvY1NuYXApID0+IHtcbiAgICAgICAgcmV0dXJuIDxDb3Vyc2U+e1xuICAgICAgICAgIGlkOiBjb3Vyc2VEb2NTbmFwLmlkLFxuICAgICAgICAgIC4uLihjb3Vyc2VEb2NTbmFwLmRhdGEoKSBhcyBvYmplY3QpLFxuICAgICAgICB9O1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlTmV3Q291cnNlKFxuICAgIGNvdXJzZVRpdGxlOiBzdHJpbmcsXG4gICAgY291cnNlRGVzY3JpcHRpb246IHN0cmluZyxcbiAgICBzZXFObzogbnVtYmVyXG4gICkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmNydWRTZXJpdmVcbiAgICAgICAgLmFkZERhdGEodGhpcy5fY291cnNlc0NvbGxlY3Rpb24sIHtcbiAgICAgICAgICB0aXRsZTogY291cnNlVGl0bGUsXG4gICAgICAgICAgZGVzY3JpcHRpb246IGNvdXJzZURlc2NyaXB0aW9uLFxuICAgICAgICAgIHNlcU5vLFxuICAgICAgICB9IGFzIENvdXJzZSlcbiAgICAgICAgLnRoZW4oKHJlcykgPT4gcmVzb2x2ZShyZXMpKVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiByZWplY3QoZXJyb3IpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGVkaXRDb3Vyc2UoY291cnNlSUQ6IHN0cmluZywgZGF0YTogYW55KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuY3J1ZFNlcml2ZVxuICAgICAgICAudXBkYXRlRGF0YSh0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbiwgY291cnNlSUQsIGRhdGEpXG4gICAgICAgIC50aGVuKChyZXMpID0+IHJlc29sdmUocmVzKSlcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gcmVqZWN0KGVycm9yKSk7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVDb3Vyc2UoY291cnNlSUQ6IHN0cmluZykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmNydWRTZXJpdmVcbiAgICAgICAgLmRlbGV0ZURhdGEodGhpcy5fY291cnNlc0NvbGxlY3Rpb24sIGNvdXJzZUlEKVxuICAgICAgICAudGhlbigocmVzKSA9PiByZXNvbHZlKHJlcykpXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHJlamVjdChlcnJvcikpO1xuICAgIH0pO1xuICB9XG5cbiAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vQ2hhcHRlcnMgTWV0aG9kczpcbiAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vR2V0IGFsbCBjaGFwdGVyc1xuICBnZXRDaGFwdGVycyhjb3Vyc2VJRDogc3RyaW5nKTogT2JzZXJ2YWJsZTxDaGFwdGVyW10+IHtcbiAgICByZXR1cm4gdGhpcy5jcnVkU2VyaXZlXG4gICAgICAuZ2V0RGF0YUJ5T3JkZXIoXG4gICAgICAgIGAvJHt0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbn0vJHtjb3Vyc2VJRH0vJHt0aGlzLl9jaGFwdGVyc0NvbGxlY3Rpb259YCxcbiAgICAgICAgJ3NlcU5vJ1xuICAgICAgKVxuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcCgoZG9jU25hcHMpID0+IHtcbiAgICAgICAgICByZXR1cm4gZG9jU25hcHMubWFwKChzbmFwKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gPENoYXB0ZXI+e1xuICAgICAgICAgICAgICBpZDogc25hcC5wYXlsb2FkLmRvYy5pZCxcbiAgICAgICAgICAgICAgLi4uKHNuYXAucGF5bG9hZC5kb2MuZGF0YSgpIGFzIG9iamVjdCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxuXG4gIC8vR2V0IGNoYXB0ZXIgSUQgYnkgc2VxTm86IDFcbiAgZ2V0Rmlyc3RDaGFwdGVyKGNvdXJzZUlEOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5jcnVkU2VyaXZlXG4gICAgICAuZ2V0U2luZ2xlRGF0YUJ5RmllbGQoXG4gICAgICAgIGAvJHt0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbn0vJHtjb3Vyc2VJRH0vJHt0aGlzLl9jaGFwdGVyc0NvbGxlY3Rpb259YCxcbiAgICAgICAgJ3NlcU5vJyxcbiAgICAgICAgMVxuICAgICAgKVxuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcCgoY2hhcHRlckRvY1NuYXApID0+IHtcbiAgICAgICAgICByZXR1cm4gY2hhcHRlckRvY1NuYXBbMF0ucGF5bG9hZC5kb2MuaWQ7XG4gICAgICAgIH0pXG4gICAgICApO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlTmV3Q291cnNlQ2hhcHRlcihcbiAgICBjb3Vyc2VJRDogc3RyaW5nLFxuICAgIGRhdGE6IHsgdGl0bGU6IHN0cmluZzsgZGVzY3JpcHRpb246IHN0cmluZzsgc2VxTm86IG51bWJlciB9XG4gICkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmNydWRTZXJpdmVcbiAgICAgICAgLmFkZERhdGFUb1N1YkNvbGxlY3Rpb24oXG4gICAgICAgICAgYC8ke3RoaXMuX2NvdXJzZXNDb2xsZWN0aW9ufS8ke2NvdXJzZUlEfS8ke3RoaXMuX2NoYXB0ZXJzQ29sbGVjdGlvbn1gLFxuICAgICAgICAgIGRhdGFcbiAgICAgICAgKVxuICAgICAgICAudGhlbigocmVzKSA9PiByZXNvbHZlKHJlcykpXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHJlamVjdChlcnJvcikpO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZWRpdENoYXB0ZXJEZXRhaWxzKGNvdXJzZUlEOiBzdHJpbmcsIGNoYXB0ZXJJRDogc3RyaW5nLCBkYXRhOiBhbnkpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5jcnVkU2VyaXZlXG4gICAgICAgIC51cGRhdGVEYXRhKFxuICAgICAgICAgIGAvJHt0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbn0vJHtjb3Vyc2VJRH0vJHt0aGlzLl9jaGFwdGVyc0NvbGxlY3Rpb259YCxcbiAgICAgICAgICBjaGFwdGVySUQsXG4gICAgICAgICAgZGF0YVxuICAgICAgICApXG4gICAgICAgIC50aGVuKChyZXMpID0+IHJlc29sdmUocmVzKSlcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gcmVqZWN0KGVycm9yKSk7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVDaGFwdGVyKGNvdXJzZUlEOiBzdHJpbmcsIGNoYXB0ZXJJRDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuY3J1ZFNlcml2ZVxuICAgICAgICAuZGVsZXRlRGF0YShcbiAgICAgICAgICBgLyR7dGhpcy5fY291cnNlc0NvbGxlY3Rpb259LyR7Y291cnNlSUR9LyR7dGhpcy5fY2hhcHRlcnNDb2xsZWN0aW9ufWAsXG4gICAgICAgICAgY2hhcHRlcklEXG4gICAgICAgIClcbiAgICAgICAgLnRoZW4oKHJlcykgPT4gcmVzb2x2ZShyZXMpKVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiByZWplY3QoZXJyb3IpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvL1Byb2plY3RzIE1ldGhvZHM6XG4gIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBhZGQgUHJvamVjdFxuICBhZGRQcm9qZWN0cyhcbiAgICBpZDogc3RyaW5nLFxuICAgIGRhdGE6IHsgdGl0bGU6IHN0cmluZzsgY29udGVudDogc3RyaW5nOyBpbWFnZTogYW55IH1cbiAgKSB7XG4gICAgdGhpcy5jcnVkU2VyaXZlLmFkZERhdGEoXG4gICAgICBgJHt0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbn0vJHtpZH0vJHt0aGlzLl9wcm9qZWN0c0NvbGxlY3Rpb259YCxcbiAgICAgIGRhdGFcbiAgICApO1xuICB9XG4gIC8vIEdldCBEYXRhIEZyb20gQ29sbGVjdGlvbiBQcm9qZWN0XG4gIGdldERhdGFQcm9qZWN0KGlkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5jcnVkU2VyaXZlXG4gICAgICAuZ2V0RGF0YShgJHt0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbn0vJHtpZH0vJHt0aGlzLl9wcm9qZWN0c0NvbGxlY3Rpb259YClcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKGRhdGEpID0+IHtcbiAgICAgICAgICByZXR1cm4gZGF0YS5tYXAoKGVsZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgaWQ6IGVsZS5wYXlsb2FkLmRvYy5pZCxcbiAgICAgICAgICAgICAgLi4uKGVsZS5wYXlsb2FkLmRvYy5kYXRhKCkgYXMgb2JqZWN0KSxcbiAgICAgICAgICAgIH0gYXMgUHJvamVjdDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cbiAgLy8gZGVsZXQgUHJvamVjdFxuICBkZWxldFByb2plY3QoaWQ6IHN0cmluZywgdWlkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5jcnVkU2VyaXZlLmRlbGV0ZURhdGEoXG4gICAgICBgJHt0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbn0vJHtpZH0vJHt0aGlzLl9wcm9qZWN0c0NvbGxlY3Rpb259YCxcbiAgICAgIHVpZFxuICAgICk7XG4gIH1cbiAgLy8gZ2V0T25lIEZvciBjYXJkIFByb2plY3RcbiAgZ2V0T25lUHJvamVjdChpZDogc3RyaW5nLCB1aWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmNydWRTZXJpdmVcbiAgICAgIC5nZXRTaWdubGVEb2MoXG4gICAgICAgIGAke3RoaXMuX2NvdXJzZXNDb2xsZWN0aW9ufS8ke2lkfS8ke3RoaXMuX3Byb2plY3RzQ29sbGVjdGlvbn1gLFxuICAgICAgICB1aWRcbiAgICAgIClcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKHByb2plY3REb2NTbmFwKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHsgLi4uKHByb2plY3REb2NTbmFwLmRhdGEoKSBhcyBvYmplY3QpIH0gYXMgUHJvamVjdDtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cbiAgLy8gIEVkaXQgQ2FyZCBGb3IgUHJvamVjdFxuICBlZGl0Q2FyZChpZDogc3RyaW5nLCB1aWQ6IHN0cmluZywgdGl0bGU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmNydWRTZXJpdmUudXBkYXRlRGF0YShcbiAgICAgIGAke3RoaXMuX2NvdXJzZXNDb2xsZWN0aW9ufS8ke2lkfS8ke3RoaXMuX3Byb2plY3RzQ29sbGVjdGlvbn1gLFxuICAgICAgdWlkLFxuICAgICAgeyB0aXRsZSB9XG4gICAgKTtcbiAgfVxuICAvLyAgRWRpdCBDb250ZW50IGluc2lkZSBQcm9qZWN0XG4gIGVkaXRDb250ZW50KGNvdXJzZUlEOiBzdHJpbmcsIHVpZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5jcnVkU2VyaXZlLnVwZGF0ZURhdGEoXG4gICAgICBgJHt0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbn0vJHtjb3Vyc2VJRH0vJHt0aGlzLl9wcm9qZWN0c0NvbGxlY3Rpb259L2AsXG4gICAgICB1aWQsXG4gICAgICB7XG4gICAgICAgIGNvbnRlbnQsXG4gICAgICB9XG4gICAgKTtcbiAgfVxuICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy9MZWN0dXJlcyBNZXRob2RzOlxuICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgZ2V0QWxsTGVjdHVyZXMoY291cnNlSUQ6IHN0cmluZywgY2hhcHRlcklEOiBzdHJpbmcpOiBPYnNlcnZhYmxlPExlY3R1cmVbXT4ge1xuICAgIHJldHVybiB0aGlzLmNydWRTZXJpdmVcbiAgICAgIC5nZXREYXRhQnlPcmRlcihcbiAgICAgICAgYC8ke3RoaXMuX2NvdXJzZXNDb2xsZWN0aW9ufS8ke2NvdXJzZUlEfS8ke3RoaXMuX2NoYXB0ZXJzQ29sbGVjdGlvbn0vJHtjaGFwdGVySUR9LyR7dGhpcy5fbGVjdHVyZXNDb2xsZWN0aW9ufWAsXG4gICAgICAgICdzZXFObydcbiAgICAgIClcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKGRvY1NuYXBzKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGRvY1NuYXBzLm1hcCgoZG9jKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gPExlY3R1cmU+e1xuICAgICAgICAgICAgICBpZDogZG9jLnBheWxvYWQuZG9jLmlkLFxuICAgICAgICAgICAgICAuLi4oZG9jLnBheWxvYWQuZG9jLmRhdGEoKSBhcyBPYmplY3QpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cblxuICBnZXRGaXJzdExlY3R1cmUoY291cnNlSUQ6IHN0cmluZywgY2hhcHRlcklkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5jcnVkU2VyaXZlXG4gICAgICAuZ2V0U2luZ2xlRGF0YUJ5RmllbGQoXG4gICAgICAgIGAvJHt0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbn0vJHtjb3Vyc2VJRH0vJHt0aGlzLl9jaGFwdGVyc0NvbGxlY3Rpb259LyR7Y2hhcHRlcklkfS8ke3RoaXMuX2xlY3R1cmVzQ29sbGVjdGlvbn1gLFxuICAgICAgICAnc2VxTm8nLFxuICAgICAgICAxXG4gICAgICApXG4gICAgICAucGlwZShcbiAgICAgICAgbWFwKChkb2NTbmFwcykgPT4ge1xuICAgICAgICAgIHJldHVybiBkb2NTbmFwc1swXS5wYXlsb2FkLmRvYy5pZDtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cblxuICBhc3luYyBhZGROZXdMZWN0dXJlKFxuICAgIGNvdXJzZUlEOiBzdHJpbmcsXG4gICAgY2hhcHRlcklEOiBzdHJpbmcsXG4gICAgZGF0YTogeyB0aXRsZTogc3RyaW5nOyBzZXFObzogbnVtYmVyIH1cbiAgKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuY3J1ZFNlcml2ZVxuICAgICAgICAuYWRkRGF0YVRvU3ViQ29sbGVjdGlvbihcbiAgICAgICAgICBgLyR7dGhpcy5fY291cnNlc0NvbGxlY3Rpb259LyR7Y291cnNlSUR9LyR7dGhpcy5fY2hhcHRlcnNDb2xsZWN0aW9ufS8ke2NoYXB0ZXJJRH0vJHt0aGlzLl9sZWN0dXJlc0NvbGxlY3Rpb259YCxcbiAgICAgICAgICBkYXRhXG4gICAgICAgIClcbiAgICAgICAgLnRoZW4oKHJlcykgPT4gcmVzb2x2ZShyZXMpKVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiByZWplY3QoZXJyb3IpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGVkaXRMZWN0dXJlRGV0YWlscyhcbiAgICBjb3Vyc2VJRDogc3RyaW5nLFxuICAgIGNoYXB0ZXJJRDogc3RyaW5nLFxuICAgIGxlY3R1cmVJRDogc3RyaW5nLFxuICAgIGRhdGE6IGFueVxuICApIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5jcnVkU2VyaXZlXG4gICAgICAgIC51cGRhdGVEYXRhKFxuICAgICAgICAgIGAvJHt0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbn0vJHtjb3Vyc2VJRH0vJHt0aGlzLl9jaGFwdGVyc0NvbGxlY3Rpb259LyR7Y2hhcHRlcklEfS8ke3RoaXMuX2xlY3R1cmVzQ29sbGVjdGlvbn1gLFxuICAgICAgICAgIGxlY3R1cmVJRCxcbiAgICAgICAgICBkYXRhXG4gICAgICAgIClcbiAgICAgICAgLnRoZW4oKHJlcykgPT4gcmVzb2x2ZShyZXMpKVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiByZWplY3QoZXJyb3IpKTtcbiAgICB9KTtcbiAgfVxuICBhc3luYyBkZWxldGVMZWN0dXJlKGNvdXJzZUlEOiBzdHJpbmcsIGNoYXB0ZXJJRDogc3RyaW5nLCBsZWN0dXJlSUQ6IHN0cmluZykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmNydWRTZXJpdmVcbiAgICAgICAgLmRlbGV0ZURhdGEoXG4gICAgICAgICAgYC8ke3RoaXMuX2NvdXJzZXNDb2xsZWN0aW9ufS8ke2NvdXJzZUlEfS8ke3RoaXMuX2NoYXB0ZXJzQ29sbGVjdGlvbn0vJHtjaGFwdGVySUR9LyR7dGhpcy5fbGVjdHVyZXNDb2xsZWN0aW9ufWAsXG4gICAgICAgICAgbGVjdHVyZUlEXG4gICAgICAgIClcbiAgICAgICAgLnRoZW4oKHJlcykgPT4gcmVzb2x2ZShyZXMpKVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiByZWplY3QoZXJyb3IpKTtcbiAgICB9KTtcbiAgfVxuICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy9TbGlkZXMgTWV0aG9kczpcbiAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIGdldEFsbFNsaWRlcyhcbiAgICBjb3Vyc2VJRDogc3RyaW5nLFxuICAgIGNoYXB0ZXJJRDogc3RyaW5nLFxuICAgIGxlY3R1cmVJRDogc3RyaW5nXG4gICk6IE9ic2VydmFibGU8U3NbXT4ge1xuICAgIHJldHVybiB0aGlzLmNydWRTZXJpdmVcbiAgICAgIC5nZXREYXRhQnlPcmRlcihcbiAgICAgICAgYC8ke3RoaXMuX2NvdXJzZXNDb2xsZWN0aW9ufS8ke2NvdXJzZUlEfS8ke3RoaXMuX2NoYXB0ZXJzQ29sbGVjdGlvbn0vJHtjaGFwdGVySUR9LyR7dGhpcy5fbGVjdHVyZXNDb2xsZWN0aW9ufS8ke2xlY3R1cmVJRH0vJHt0aGlzLl9zbGlkZXNDb2xsZWN0aW9ufWAsXG4gICAgICAgICdzZXFObydcbiAgICAgIClcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKGRvY1NuYXBzKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGRvY1NuYXBzLm1hcCgoZG9jU25hcCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIDxTcz57XG4gICAgICAgICAgICAgIGlkOiBkb2NTbmFwLnBheWxvYWQuZG9jLmlkLFxuICAgICAgICAgICAgICAuLi4oZG9jU25hcC5wYXlsb2FkLmRvYy5kYXRhKCkgYXMgb2JqZWN0KSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgICApO1xuICB9XG5cbiAgYXN5bmMgYWRkU2xpZGUoXG4gICAgY291cnNlSUQ6IHN0cmluZyxcbiAgICBjaGFwdGVySUQ6IHN0cmluZyxcbiAgICBsZWN0dXJlSUQ6IHN0cmluZyxcbiAgICBkYXRhOiBTc1xuICApIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5jcnVkU2VyaXZlXG4gICAgICAgIC5hZGREYXRhVG9TdWJDb2xsZWN0aW9uKFxuICAgICAgICAgIGAvJHt0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbn0vJHtjb3Vyc2VJRH0vJHt0aGlzLl9jaGFwdGVyc0NvbGxlY3Rpb259LyR7Y2hhcHRlcklEfS8ke3RoaXMuX2xlY3R1cmVzQ29sbGVjdGlvbn0vJHtsZWN0dXJlSUR9LyR7dGhpcy5fc2xpZGVzQ29sbGVjdGlvbn1gLFxuICAgICAgICAgIGRhdGFcbiAgICAgICAgKVxuICAgICAgICAudGhlbigocmVzKSA9PiByZXNvbHZlKHJlcykpXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHJlamVjdChlcnJvcikpO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZWRpdFNsaWRlKFxuICAgIGNvdXJzZUlEOiBzdHJpbmcsXG4gICAgY2hhcHRlcklEOiBzdHJpbmcsXG4gICAgbGVjdHVyZUlEOiBzdHJpbmcsXG4gICAgc2xpZGVJRDogc3RyaW5nLFxuICAgIGRhdGE6IGFueVxuICApIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5jcnVkU2VyaXZlXG4gICAgICAgIC51cGRhdGVEYXRhKFxuICAgICAgICAgIGAvJHt0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbn0vJHtjb3Vyc2VJRH0vJHt0aGlzLl9jaGFwdGVyc0NvbGxlY3Rpb259LyR7Y2hhcHRlcklEfS8ke3RoaXMuX2xlY3R1cmVzQ29sbGVjdGlvbn0vJHtsZWN0dXJlSUR9LyR7dGhpcy5fc2xpZGVzQ29sbGVjdGlvbn1gLFxuICAgICAgICAgIHNsaWRlSUQsXG4gICAgICAgICAgZGF0YVxuICAgICAgICApXG4gICAgICAgIC50aGVuKChyZXMpID0+IHJlc29sdmUocmVzKSlcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gcmVqZWN0KGVycm9yKSk7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVTbGlkZShcbiAgICBjb3Vyc2VJRDogc3RyaW5nLFxuICAgIGNoYXB0ZXJJRDogc3RyaW5nLFxuICAgIGxlY3R1cmVJRDogc3RyaW5nLFxuICAgIHNsaWRlSUQ6IHN0cmluZ1xuICApIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5jcnVkU2VyaXZlXG4gICAgICAgIC5kZWxldGVEYXRhKFxuICAgICAgICAgIGAvJHt0aGlzLl9jb3Vyc2VzQ29sbGVjdGlvbn0vJHtjb3Vyc2VJRH0vJHt0aGlzLl9jaGFwdGVyc0NvbGxlY3Rpb259LyR7Y2hhcHRlcklEfS8ke3RoaXMuX2xlY3R1cmVzQ29sbGVjdGlvbn0vJHtsZWN0dXJlSUR9LyR7dGhpcy5fc2xpZGVzQ29sbGVjdGlvbn1gLFxuICAgICAgICAgIHNsaWRlSURcbiAgICAgICAgKVxuICAgICAgICAudGhlbigocmVzKSA9PiByZXNvbHZlKHJlcykpXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHJlamVjdChlcnJvcikpO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0Rmlyc3RDb3Vyc2UoKXtcbiAgICByZXR1cm4gdGhpcy5jcnVkU2VyaXZlLmdldFNpbmdsZURhdGFBc2ModGhpcy5fY291cnNlc0NvbGxlY3Rpb24pO1xuICAgIC8vIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSxyZWplY3QpPT57XG4gICAgLy8gfSlcbiAgfVxuICAvLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbn1cbiJdfQ==