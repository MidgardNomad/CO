import { Injectable } from '@angular/core';
import { map } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/fire/compat/firestore";
export class CrudService {
    constructor(db) {
        this.db = db;
    }
    // get all data (snapshot)
    getData(collection) {
        return this.db.collection(collection).snapshotChanges();
    }
    //get all data using get()
    getAllData(collection) {
        return this.db.collection(collection).get();
    }
    //set a single Document with a custom ID
    setSingleDoc(collectionName, docID, data) {
        return this.db.doc(`/${collectionName}/${docID}`).set(data);
    }
    //Get a document by ID
    getSignleDoc(collectionName, docID) {
        return this.db.doc(`/${collectionName}/${docID}`).get();
    }
    //Create a subcollection
    addDataToSubCollection(collectionPath, data) {
        return this.db.collection(collectionPath).add(data);
    }
    //get data from a sub collection
    getSubCollectionData(collectionPath) {
        return this.db.collection(collectionPath).get();
    }
    // add data
    addData(collectionName, data) {
        return this.db.collection(collectionName).add(data);
    }
    // update data
    updateData(collectionName, id, data) {
        return this.db.collection(collectionName).doc(id).update(data);
    }
    // delete data
    deleteData(collectionName, id) {
        return this.db.collection(collectionName).doc(id).delete();
    }
    // get single data
    getSingleData(collectionName, id) {
        return this.db.collection(collectionName).doc(id).get();
    }
    //Get Single Doc snapshot
    getSignleDocSnap(collectionName, id) {
        return this.db.collection(collectionName).doc(id).snapshotChanges();
    }
    //Get Data Ordered
    getDataByOrder(collectionpath, field) {
        return this.db
            .collection(collectionpath, (ref) => ref.orderBy(field))
            .snapshotChanges();
    }
    getSingleDocByField(collectionName, field, value) {
        return this.db
            .collection(collectionName, (ref) => ref.where(field, '==', value))
            .get();
    }
    getDocByTwoField(collectionName, field1, value1, field2, value2) {
        return this.db
            .collection(collectionName, (ref) => ref.where(field1, '==', value1).where(field2, '==', value2))
            .get().pipe(map((res) => res.docs.map((c) => { return { ...c.data() }; })));
    }
    getDocByThreeField(collectionName, field1, value1, field2, value2, field3, value3) {
        return this.db
            .collection(collectionName, (ref) => ref.where(field1, '==', value1).where(field2, '==', value2).where(field3, '==', value3))
            .get().pipe(map((res) => res.docs.map((c) => { return { ...c.data(), id: c.id }; })));
    }
    // get single data snapshotChanges
    getSingleDataByField(collectionName, field, value) {
        return this.db
            .collection(collectionName, (ref) => ref.where(field, '==', value))
            .snapshotChanges();
    }
    // get single data snapshotChanges
    getDataByOneField(collectionName, field, value) {
        return this.db
            .collection(collectionName, (ref) => ref.where(field, '==', value))
            .get().pipe(map((res) => res.docs.map((c) => { return { ...c.data(), id: c.id }; })));
    }
    // get single data Asc
    getSingleDataAsc(collectionName) {
        return this.db
            .collection(collectionName, (ref) => ref.orderBy('seqNo').limit(1))
            .get().pipe(map(data => { const doc = data.docs[0]; return doc ? { id: doc.id, ...doc.data } : null; }));
    }
    // get single data
    getSingleDataByFieldWithLimit(collectionName, field, value, limit) {
        return this.db
            .collection(collectionName, (ref) => ref.where(field, '==', value).limit(limit))
            .snapshotChanges();
    }
    // get single data
    getSingleDataByFieldWithOrder(collectionName, field, value, orderField, order) {
        return this.db
            .collection(collectionName, (ref) => ref.where(field, '==', value).orderBy(orderField, order))
            .snapshotChanges();
    }
    // get single data
    getSingleDataByFieldWithOrderAndLimit(collectionName, field, value, orderField, order, limit) {
        return this.db
            .collection(collectionName, (ref) => ref.where(field, '==', value).orderBy(orderField, order).limit(limit))
            .snapshotChanges();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: CrudService, deps: [{ token: i1.AngularFirestore }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: CrudService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: CrudService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: function () { return [{ type: i1.AngularFirestore }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3J1ZC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvZGFsL3NyYy9saWIvc2VydmljZXMvY3J1ZC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHM0MsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLE1BQU0sQ0FBQzs7O0FBSzNCLE1BQU0sT0FBTyxXQUFXO0lBQ3RCLFlBQW9CLEVBQW9CO1FBQXBCLE9BQUUsR0FBRixFQUFFLENBQWtCO0lBQUcsQ0FBQztJQUU1QywwQkFBMEI7SUFDMUIsT0FBTyxDQUFDLFVBQWtCO1FBQ3hCLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDMUQsQ0FBQztJQUVELDBCQUEwQjtJQUMxQixVQUFVLENBQUMsVUFBa0I7UUFDM0IsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUM5QyxDQUFDO0lBRUQsd0NBQXdDO0lBQ3hDLFlBQVksQ0FBQyxjQUFzQixFQUFFLEtBQWEsRUFBRSxJQUFTO1FBQzNELE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxjQUFjLElBQUksS0FBSyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDOUQsQ0FBQztJQUVELHNCQUFzQjtJQUN0QixZQUFZLENBQUMsY0FBc0IsRUFBRSxLQUFhO1FBQ2hELE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxjQUFjLElBQUksS0FBSyxFQUFFLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUMxRCxDQUFDO0lBRUQsd0JBQXdCO0lBQ3hCLHNCQUFzQixDQUFDLGNBQXNCLEVBQUUsSUFB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RUFBRSxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQzNDO2FBQ0EsZUFBZSxFQUFFLENBQUM7SUFDdkIsQ0FBQztJQUVELGtCQUFrQjtJQUNsQiw2QkFBNkIsQ0FDM0IsY0FBc0IsRUFDdEIsS0FBYSxFQUNiLEtBQVUsRUFDVixVQUFrQixFQUNsQixLQUF1QjtRQUV2QixPQUFPLElBQUksQ0FBQyxFQUFFO2FBQ1gsVUFBVSxDQUFDLGNBQWMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQ2xDLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUN6RDthQUNBLGVBQWUsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxrQkFBa0I7SUFDbEIscUNBQXFDLENBQ25DLGNBQXNCLEVBQ3RCLEtBQWEsRUFDYixLQUFVLEVBQ1YsVUFBa0IsRUFDbEIsS0FBdUIsRUFDdkIsS0FBYTtRQUViLE9BQU8sSUFBSSxDQUFDLEVBQUU7YUFDWCxVQUFVLENBQUMsY0FBYyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FDbEMsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUN0RTthQUNBLGVBQWUsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7K0dBbkpVLFdBQVc7bUhBQVgsV0FBVyxjQUZWLE1BQU07OzRGQUVQLFdBQVc7a0JBSHZCLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQW5ndWxhckZpcmVzdG9yZSB9IGZyb20gJ0Bhbmd1bGFyL2ZpcmUvY29tcGF0L2ZpcmVzdG9yZSc7XG5pbXBvcnQgeyBPcmRlckJ5RGlyZWN0aW9uIH0gZnJvbSAnZmlyZWJhc2UvZmlyZXN0b3JlJztcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMnO1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgQ3J1ZFNlcnZpY2Uge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRiOiBBbmd1bGFyRmlyZXN0b3JlKSB7fVxuXG4gIC8vIGdldCBhbGwgZGF0YSAoc25hcHNob3QpXG4gIGdldERhdGEoY29sbGVjdGlvbjogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZGIuY29sbGVjdGlvbihjb2xsZWN0aW9uKS5zbmFwc2hvdENoYW5nZXMoKTtcbiAgfVxuXG4gIC8vZ2V0IGFsbCBkYXRhIHVzaW5nIGdldCgpXG4gIGdldEFsbERhdGEoY29sbGVjdGlvbjogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZGIuY29sbGVjdGlvbihjb2xsZWN0aW9uKS5nZXQoKTtcbiAgfVxuXG4gIC8vc2V0IGEgc2luZ2xlIERvY3VtZW50IHdpdGggYSBjdXN0b20gSURcbiAgc2V0U2luZ2xlRG9jKGNvbGxlY3Rpb25OYW1lOiBzdHJpbmcsIGRvY0lEOiBzdHJpbmcsIGRhdGE6IGFueSkge1xuICAgIHJldHVybiB0aGlzLmRiLmRvYyhgLyR7Y29sbGVjdGlvbk5hbWV9LyR7ZG9jSUR9YCkuc2V0KGRhdGEpO1xuICB9XG5cbiAgLy9HZXQgYSBkb2N1bWVudCBieSBJRFxuICBnZXRTaWdubGVEb2MoY29sbGVjdGlvbk5hbWU6IHN0cmluZywgZG9jSUQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmRiLmRvYyhgLyR7Y29sbGVjdGlvbk5hbWV9LyR7ZG9jSUR9YCkuZ2V0KCk7XG4gIH1cblxuICAvL0NyZWF0ZSBhIHN1YmNvbGxlY3Rpb25cbiAgYWRkRGF0YVRvU3ViQ29sbGVjdGlvbihjb2xsZWN0aW9uUGF0aDogc3RyaW5nLCBkYXRhOiBhbnkpIHtcbiAgICByZXR1cm4gdGhpcy5kYi5jb2xsZWN0aW9uKGNvbGxlY3Rpb25QYXRoKS5hZGQoZGF0YSk7XG4gIH1cblxuICAvL2dldCBkYXRhIGZyb20gYSBzdWIgY29sbGVjdGlvblxuICBnZXRTdWJDb2xsZWN0aW9uRGF0YShjb2xsZWN0aW9uUGF0aDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZGIuY29sbGVjdGlvbihjb2xsZWN0aW9uUGF0aCkuZ2V0KCk7XG4gIH1cblxuICAvLyBhZGQgZGF0YVxuICBhZGREYXRhKGNvbGxlY3Rpb25OYW1lOiBzdHJpbmcsIGRhdGE6IGFueSkge1xuICAgIHJldHVybiB0aGlzLmRiLmNvbGxlY3Rpb24oY29sbGVjdGlvbk5hbWUpLmFkZChkYXRhKTtcbiAgfVxuXG4gIC8vIHVwZGF0ZSBkYXRhXG4gIHVwZGF0ZURhdGEoY29sbGVjdGlvbk5hbWU6IHN0cmluZywgaWQ6IGFueSwgZGF0YTogYW55KSB7XG4gICAgcmV0dXJuIHRoaXMuZGIuY29sbGVjdGlvbihjb2xsZWN0aW9uTmFtZSkuZG9jKGlkKS51cGRhdGUoZGF0YSk7XG4gIH1cblxuICAvLyBkZWxldGUgZGF0YVxuICBkZWxldGVEYXRhKGNvbGxlY3Rpb25OYW1lOiBzdHJpbmcsIGlkOiBhbnkpIHtcbiAgICByZXR1cm4gdGhpcy5kYi5jb2xsZWN0aW9uKGNvbGxlY3Rpb25OYW1lKS5kb2MoaWQpLmRlbGV0ZSgpO1xuICB9XG5cbiAgLy8gZ2V0IHNpbmdsZSBkYXRhXG4gIGdldFNpbmdsZURhdGEoY29sbGVjdGlvbk5hbWU6IHN0cmluZywgaWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmRiLmNvbGxlY3Rpb24oY29sbGVjdGlvbk5hbWUpLmRvYyhpZCkuZ2V0KCk7XG4gIH1cblxuICAvL0dldCBTaW5nbGUgRG9jIHNuYXBzaG90XG4gIGdldFNpZ25sZURvY1NuYXAoY29sbGVjdGlvbk5hbWU6IHN0cmluZywgaWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmRiLmNvbGxlY3Rpb24oY29sbGVjdGlvbk5hbWUpLmRvYyhpZCkuc25hcHNob3RDaGFuZ2VzKCk7XG4gIH1cblxuICAvL0dldCBEYXRhIE9yZGVyZWRcbiAgZ2V0RGF0YUJ5T3JkZXIoY29sbGVjdGlvbnBhdGg6IHN0cmluZywgZmllbGQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmRiXG4gICAgICAuY29sbGVjdGlvbihjb2xsZWN0aW9ucGF0aCwgKHJlZikgPT4gcmVmLm9yZGVyQnkoZmllbGQpKVxuICAgICAgLnNuYXBzaG90Q2hhbmdlcygpO1xuICB9XG5cbiAgZ2V0U2luZ2xlRG9jQnlGaWVsZChjb2xsZWN0aW9uTmFtZTogc3RyaW5nLCBmaWVsZDogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gICAgcmV0dXJuIHRoaXMuZGJcbiAgICAgIC5jb2xsZWN0aW9uKGNvbGxlY3Rpb25OYW1lLCAocmVmKSA9PiByZWYud2hlcmUoZmllbGQsICc9PScsIHZhbHVlKSlcbiAgICAgIC5nZXQoKTtcbiAgfVxuXG4gIGdldERvY0J5VHdvRmllbGQoY29sbGVjdGlvbk5hbWU6IHN0cmluZywgZmllbGQxOiBzdHJpbmcsIHZhbHVlMTogYW55LGZpZWxkMjpzdHJpbmcsdmFsdWUyOmFueSkge1xuICAgIHJldHVybiB0aGlzLmRiXG4gICAgICAuY29sbGVjdGlvbihjb2xsZWN0aW9uTmFtZSwgKHJlZikgPT4gcmVmLndoZXJlKGZpZWxkMSwgJz09JywgdmFsdWUxKS53aGVyZShmaWVsZDIsJz09Jyx2YWx1ZTIpKVxuICAgICAgLmdldCgpLnBpcGUobWFwKChyZXMpID0+IHJlcy5kb2NzLm1hcCgoYzogYW55KSA9PiB7IHJldHVybiB7IC4uLmMuZGF0YSgpIH07IH0pKSlcbiAgfVxuXG4gIGdldERvY0J5VGhyZWVGaWVsZChjb2xsZWN0aW9uTmFtZTogc3RyaW5nLCBmaWVsZDE6IHN0cmluZywgdmFsdWUxOiBhbnksZmllbGQyOnN0cmluZyx2YWx1ZTI6YW55LGZpZWxkMzpzdHJpbmcsdmFsdWUzOmFueSkge1xuICAgIHJldHVybiB0aGlzLmRiXG4gICAgICAuY29sbGVjdGlvbihjb2xsZWN0aW9uTmFtZSwgKHJlZikgPT4gcmVmLndoZXJlKGZpZWxkMSwgJz09JywgdmFsdWUxKS53aGVyZShmaWVsZDIsJz09Jyx2YWx1ZTIpLndoZXJlKGZpZWxkMywnPT0nLHZhbHVlMykpXG4gICAgICAuZ2V0KCkucGlwZShtYXAoKHJlcykgPT4gcmVzLmRvY3MubWFwKChjOiBhbnkpID0+IHsgcmV0dXJuIHsgLi4uYy5kYXRhKCksaWQ6Yy5pZCB9OyB9KSkpXG4gIH1cblxuICAvLyBnZXQgc2luZ2xlIGRhdGEgc25hcHNob3RDaGFuZ2VzXG4gIGdldFNpbmdsZURhdGFCeUZpZWxkKGNvbGxlY3Rpb25OYW1lOiBzdHJpbmcsIGZpZWxkOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcbiAgICByZXR1cm4gdGhpcy5kYlxuICAgICAgLmNvbGxlY3Rpb24oY29sbGVjdGlvbk5hbWUsIChyZWYpID0+IHJlZi53aGVyZShmaWVsZCwgJz09JywgdmFsdWUpKVxuICAgICAgLnNuYXBzaG90Q2hhbmdlcygpO1xuICB9XG5cbiAgLy8gZ2V0IHNpbmdsZSBkYXRhIHNuYXBzaG90Q2hhbmdlc1xuICBnZXREYXRhQnlPbmVGaWVsZChjb2xsZWN0aW9uTmFtZTogc3RyaW5nLCBmaWVsZDogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gICAgcmV0dXJuIHRoaXMuZGJcbiAgICAgIC5jb2xsZWN0aW9uKGNvbGxlY3Rpb25OYW1lLCAocmVmKSA9PiByZWYud2hlcmUoZmllbGQsICc9PScsIHZhbHVlKSlcbiAgICAgIC5nZXQoKS5waXBlKG1hcCgocmVzKSA9PiByZXMuZG9jcy5tYXAoKGM6IGFueSkgPT4geyByZXR1cm4geyAuLi5jLmRhdGEoKSxpZDpjLmlkIH07IH0pKSlcbiAgfVxuXG4gICAgLy8gZ2V0IHNpbmdsZSBkYXRhIEFzY1xuICAgIGdldFNpbmdsZURhdGFBc2MoY29sbGVjdGlvbk5hbWU6IHN0cmluZykge1xuICAgICAgcmV0dXJuIHRoaXMuZGJcbiAgICAgICAgLmNvbGxlY3Rpb24oY29sbGVjdGlvbk5hbWUsIChyZWYpID0+IHJlZi5vcmRlckJ5KCdzZXFObycpLmxpbWl0KDEpKVxuICAgICAgICAuZ2V0KCkucGlwZShtYXAoZGF0YSA9PiB7IGNvbnN0IGRvYyA9IGRhdGEuZG9jc1swXTsgcmV0dXJuIGRvYyA/IHsgaWQ6IGRvYy5pZCwgLi4uZG9jLmRhdGEgfSA6IG51bGx9KSk7XG4gICAgfVxuXG4gIC8vIGdldCBzaW5nbGUgZGF0YVxuICBnZXRTaW5nbGVEYXRhQnlGaWVsZFdpdGhMaW1pdChcbiAgICBjb2xsZWN0aW9uTmFtZTogc3RyaW5nLFxuICAgIGZpZWxkOiBzdHJpbmcsXG4gICAgdmFsdWU6IGFueSxcbiAgICBsaW1pdDogbnVtYmVyXG4gICkge1xuICAgIHJldHVybiB0aGlzLmRiXG4gICAgICAuY29sbGVjdGlvbihjb2xsZWN0aW9uTmFtZSwgKHJlZikgPT5cbiAgICAgICAgcmVmLndoZXJlKGZpZWxkLCAnPT0nLCB2YWx1ZSkubGltaXQobGltaXQpXG4gICAgICApXG4gICAgICAuc25hcHNob3RDaGFuZ2VzKCk7XG4gIH1cblxuICAvLyBnZXQgc2luZ2xlIGRhdGFcbiAgZ2V0U2luZ2xlRGF0YUJ5RmllbGRXaXRoT3JkZXIoXG4gICAgY29sbGVjdGlvbk5hbWU6IHN0cmluZyxcbiAgICBmaWVsZDogc3RyaW5nLFxuICAgIHZhbHVlOiBhbnksXG4gICAgb3JkZXJGaWVsZDogc3RyaW5nLFxuICAgIG9yZGVyOiBPcmRlckJ5RGlyZWN0aW9uXG4gICkge1xuICAgIHJldHVybiB0aGlzLmRiXG4gICAgICAuY29sbGVjdGlvbihjb2xsZWN0aW9uTmFtZSwgKHJlZikgPT5cbiAgICAgICAgcmVmLndoZXJlKGZpZWxkLCAnPT0nLCB2YWx1ZSkub3JkZXJCeShvcmRlckZpZWxkLCBvcmRlcilcbiAgICAgIClcbiAgICAgIC5zbmFwc2hvdENoYW5nZXMoKTtcbiAgfVxuXG4gIC8vIGdldCBzaW5nbGUgZGF0YVxuICBnZXRTaW5nbGVEYXRhQnlGaWVsZFdpdGhPcmRlckFuZExpbWl0KFxuICAgIGNvbGxlY3Rpb25OYW1lOiBzdHJpbmcsXG4gICAgZmllbGQ6IHN0cmluZyxcbiAgICB2YWx1ZTogYW55LFxuICAgIG9yZGVyRmllbGQ6IHN0cmluZyxcbiAgICBvcmRlcjogT3JkZXJCeURpcmVjdGlvbixcbiAgICBsaW1pdDogbnVtYmVyXG4gICkge1xuICAgIHJldHVybiB0aGlzLmRiXG4gICAgICAuY29sbGVjdGlvbihjb2xsZWN0aW9uTmFtZSwgKHJlZikgPT5cbiAgICAgICAgcmVmLndoZXJlKGZpZWxkLCAnPT0nLCB2YWx1ZSkub3JkZXJCeShvcmRlckZpZWxkLCBvcmRlcikubGltaXQobGltaXQpXG4gICAgICApXG4gICAgICAuc25hcHNob3RDaGFuZ2VzKCk7XG4gIH1cbn1cbiJdfQ==